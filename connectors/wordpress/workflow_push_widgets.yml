workflow:
  name: "wordpress-push-widgets"
  title: "WordPress Push Widgets/Blocks"
  description: "Create a draft post with optional shortcode and raw Gutenberg blocks with auto token refresh."
  inputs:
    title: "$.get('title', 'Post with widgets')"
    content_html: "$.get('content_html', '<p>Post body</p>')"
    excerpt: "$.get('excerpt')"
    shortcode: "$.get('shortcode')"
    block: "$.get('block')"
    blocks: "$.get('blocks', [])"
    images: "$.get('images', [])"
    categories: "$.get('categories', [])"
    tags: "$.get('tags', [])"
    auto_append_images: "$.get('auto_append_images', true)"
    set_featured_image: "$.get('set_featured_image', true)"
  outputs:
    post_id: "$.get('post_id')"
    draft_url: "$.get('draft_url')"
    access_token: "$.get('access_token')"
    workflow-status: "$.get('workflow-status', 'completed')"
  tasks:
    - type: "connector"
      name: "refresh-token"
      description: "Refresh WordPress.com access token"
      connector:
        name: "wordpress"
        command: "refresh_wpcom_access_token"
      inputs:
        client_id: "${MACHINA_CONTEXT_VARIABLE_WPCOM_CLIENT_ID}"
        client_secret: "${MACHINA_CONTEXT_VARIABLE_WPCOM_CLIENT_SECRET}"
        refresh_token: "${MACHINA_CONTEXT_VARIABLE_WPCOM_REFRESH_TOKEN}"
      outputs:
        access_token: "$.get('data').get('access_token')"
        
    - type: "connector"
      name: "create-draft-post"
      description: "Create a draft post with widgets/blocks in WordPress"
      connector:
        name: "wordpress"
        command: "create_draft_post"
      headers:
        site_url: "${MACHINA_CONTEXT_VARIABLE_WORDPRESS_SITE_URL}"
        authorization: "Bearer $('access_token')"
      inputs:
        title: "title"
        content_html: "content_html"
        excerpt: "excerpt"
        shortcode: "shortcode"
        block: "block"
        blocks: "blocks"
        images: "images"
        categories: "categories"
        tags: "tags"
        auto_append_images: "auto_append_images"
        set_featured_image: "set_featured_image"
      outputs:
        post_id: "$.get('data').get('post').get('id')"
        draft_url: "$.get('data').get('post').get('link')"
        workflow-status: "completed"