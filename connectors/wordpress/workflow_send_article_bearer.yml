workflow:
  name: "wordpress-send-article-bearer"
  title: "WordPress Send Article (Bearer)"
  description: "Read article JSON, transform, and push draft using a stored Bearer token (no refresh)."
  context-variables:
    wordpress:
      site_url: "$MACHINA_CONTEXT_VARIABLE_WORDPRESS_SITE_URL"
      bearer_token: "$MACHINA_CONTEXT_VARIABLE_WORDPRESS_BEARER_TOKEN"
  inputs:
    # escolha um dos dois modos de seleção: por id ou por índice
    file_path: "$.get('file_path', 'articles.model.json')"
    object_id: "$.get('object_id')"          # ex.: 689c92ab099ca6ccf96a7c94
    id_path: "$.get('id_path', '_id.$oid')"
    json_pointer: "$.get('json_pointer', '0.value')"  # usado quando object_id está vazio
    images: "$.get('images', [])"
  outputs:
    post_id: "$['post'].get('id')"
    draft_url: "$['post'].get('link')"
    workflow-status: "$['post'].get('id') is None and 'skipped' or 'executed'"
  tasks:
    - type: "connector"
      name: "read article by id"
      condition: "$['object_id'] is not None"
      connector:
        name: "json-reader"
        command: "read_json_by_id"
      inputs:
        file_path: "$['file_path']"
        object_id: "$['object_id']"
        id_path: "$['id_path']"
        json_pointer: "$.get('json_pointer', 'value')"
      outputs:
        article: "$"

    - type: "connector"
      name: "read article by index"
      condition: "$['object_id'] is None"
      connector:
        name: "json-reader"
        command: "read_json_file"
      inputs:
        file_path: "$['file_path']"
        json_pointer: "$['json_pointer']"
      outputs:
        article: "$"

    - type: "connector"
      name: "transform article"
      connector:
        name: "transform"
        command: "article_model_to_wp_params"
      inputs:
        article: "$['article']"
        images: "$['images']"
      outputs:
        title: "$['title']"
        content_html: "$['content_html']"
        excerpt: "$['excerpt']"
        images: "$['images']"

    - type: "connector"
      name: "create draft post"
      connector:
        name: "wordpress"
        command: "create_draft_post"
      headers:
        site_url: "$['site_url']"
        bearer_token: "$['bearer_token']"
      inputs:
        title: "$['title']"
        content_html: "$['content_html']"
        excerpt: "$['excerpt']"
        images: "$['images']"
      outputs:
        post: "$['post']"


