workflow:
  name: "google-genai-test-image"
  title: "Google Gemini Test Image"
  description: "Workflow to test the Google Gemini image processing. Supports: single image (image_path), array of images (image_paths), or individual fields (image_path_1, image_path_2, etc.)."
  context-variables:
    debugger:
      enabled: true
    google-genai:
      api_key: "$MACHINA_CONTEXT_VARIABLE_GOOGLE_GENAI_API_KEY"
    google-storage:
      api_key: "$MACHINA_CONTEXT_VARIABLE_GOOGLE_STORAGE_API_KEY"
      bucket_name: "$MACHINA_CONTEXT_VARIABLE_GOOGLE_STORAGE_BUCKET_NAME"
  inputs:
    model_name: "$.get('model_name', 'gemini-2.5-flash-image-preview')"
    prompt: "$.get('prompt')"
    aspect_ratio: "$.get('aspect_ratio')"  # e.g., "16:9", "1:1", "9:16"
    image_path: "$.get('image_path')"  # For backward compatibility
    image_paths: "$.get('image_paths', [])"  # Array of image paths
    image_path_1: "$.get('image_path_1')"  # Individual image fields
    image_path_2: "$.get('image_path_2')"
    image_path_3: "$.get('image_path_3')"
    image_path_4: "$.get('image_path_4')"
    image_path_5: "$.get('image_path_5')"
  outputs:
    workflow-status: "$.get('workflow-status', 'skipped')"
  tasks:
    
    # 1 test-image
    - type: "connector"
      name: "test-image"
      description: "Test the Google Gemini image processing."
      connector:
        name: "google-genai"
        command: "invoke_image"
      inputs:
        model_name: "$.get('model_name')"
        prompt: "$.get('prompt')"
        aspect_ratio: "$.get('aspect_ratio')"  # e.g., "16:9", "1:1", "9:16"
        image_path: "$.get('image_path')"  # For backward compatibility
        image_paths: "$.get('image_paths')"  # Array of image paths
        image_path_1: "$.get('image_path_1')"  # Individual image fields
        image_path_2: "$.get('image_path_2')"
        image_path_3: "$.get('image_path_3')"
        image_path_4: "$.get('image_path_4')"
        image_path_5: "$.get('image_path_5')"
      outputs:
        data: "$"
        image_path: "$.get('image_path')"
    
    # 2 save-image
    - type: "connector"
      name: "save-image"
      description: "Save the image to the Google Storage."
      connector:
        name: "google-storage"
        command: "invoke_upload"
      inputs:
        image_path: "$.get('image_path')"
      outputs:
        data: "$"
        workflow-status: "'executed'"