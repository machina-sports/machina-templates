workflow:
  name: "grok-test-chat-completion"
  title: "Grok Test Chat Completion"
  description: "Workflow to test the xAI Grok API chat completion functionality."
  context-variables:
    debugger:
      enabled: true
    grok:
      authorization: "$MACHINA_CONTEXT_VARIABLE_GROK_API_KEY"
  inputs:
    user_message: "$.get('user_message', 'Search for recent tweets about 49ers')"
    model: "$.get('model', 'grok-4-latest')"
    temperature: "$.get('temperature', 0)"
    max_tokens: "$.get('max_tokens', 500)"
  outputs:
    data: "$.get('data')"
    workflow-status: "'executed'"
  tasks:

    # 1 test-live-search
    - type: "connector"
      name: "test-live-search"
      description: "Test the xAI Grok API live search on X platform."
      connector:
        name: "grok"
        command: "post-chat/completions"
      inputs:
        body: |
          {
            "messages": [
              {
                "role": "user",
                "content": $.get('user_message')
              }
            ],
            "model": $.get('model'),
            "stream": False,
            "temperature": $.get('temperature'),
            "max_tokens": $.get('max_tokens'),
            "search_parameters": {
              "mode": "on",
              "sources": [
                {
                  "type": "x"
                }
              ],
              "from_date": (datetime.utcnow() - timedelta(days=3)).strftime('%Y-%m-%d'),
              "to_date": (datetime.utcnow() + timedelta(days=3)).strftime('%Y-%m-%d')
            },
            "response_format": {
              "type": "json_schema",
              "json_schema": {
                "name": "sentiment_analysis",
                "schema": {
                  "type": "object",
                  "properties": {
                    "analysis": {
                      "type": "string",
                      "description": "The analysis of the tweets about the subject"
                    },
                    "sentiment_rating": {
                      "type": "integer",
                      "minimum": 1,
                      "maximum": 5,
                      "description": "Sentiment rating from 1 (very negative) to 5 (very positive)"
                    }
                  },
                  "required": ["analysis", "sentiment_rating"],
                  "additionalProperties": False
                }
              }
            }
          }
      outputs:
        data: "$"
        workflow-status: "'executed'"
