workflow:
  name: basketball-stats-sync-games
  title: Basketball Stats - Sync Games
  description: Comprehensive workflow to sync games from API Basketball with support for single/multiple IDs, live games, date ranges, league/team filtering, and venue-specific queries.
  context-variables:
    debugger:
      enabled: true
    api-basketball:
      x-apisports-key: "$TEMP_CONTEXT_VARIABLE_API_BASKETBALL_API_KEY"
    machina-ai:
      api_key: "$TEMP_CONTEXT_VARIABLE_SDK_OPENAI_API_KEY"
  inputs:
    id: "$.get('id')"
    date: "$.get('date')"
    league: "$.get('league')"
    season: "$.get('season')"
    team: "$.get('team')"
    timezone: "$.get('timezone')"
  outputs:
    workflow-status: "'executed'"
  tasks:

    - type: connector
      name: api-basketball-get-games
      description: Get games from API Basketball.
      connector:
        name: api-basketball
        command: "get-games"
      inputs:
        id: "$.get('id')"
        date: "$.get('date')"
        league: "$.get('league')"
        season: "$.get('season')"
        team: "$.get('team')"
        timezone: "$.get('timezone')"
      outputs:
        games: "$.get('response')"

    # task-bulk-save-games
    - type: document
      name: task-bulk-save-games
      description: Bulk save the individual games.
      config:
        action: "bulk-update"
        embed-selector: "$.get('title')"
        embed-vector: true
        force-update: true
      connector:
        name: "machina-ai"
        command: "invoke_embedding"
        model: "text-embedding-3-small"
      document_name: "basketball-game"
      documents:
        items: |
          [
            {
              **g,
              'metadata': {
                'game_id': str(g.get('game', {}).get('id', '')),
              },
              'title': f"{g.get('teams', {}).get('home', {}).get('name', '')} vs {g.get('teams', {}).get('away', {}).get('name', '')}"
            }
            for g in $.get('games', [])
          ]
      metadata:
        document_type: "'game'"