mapping:
  name: soccer-league-config
  title: Soccer League Configuration
  description: |
    Centralized configuration mapping for all supported soccer leagues.
    Maps API-Football league IDs to Kalshi series tickers and competition metadata.
  input-labels:
    - league_key  # Key to look up (e.g., 'epl', 'serie_a', 'bundesliga')
  output-labels:
    - league_config
    - all_leagues
    - kalshi_series_ids
  operations:

    # Define all supported leagues
    - type: globals
      labels:
        - all_leagues
      value: |
        {
          'epl': {
            'name': 'Premier League',
            'api_football_league_id': '39',
            'season': '2025',
            'country': 'England',
            'kalshi_series': ['KXEPLGAME', 'KXEPLBTTS', 'KXEPLTOTALS', 'KXEPLWINNER'],
            'kalshi_game_series': 'KXEPLGAME',
            'enabled': True,
            'priority': 1
          },
          'serie_a': {
            'name': 'Serie A',
            'api_football_league_id': '135',
            'season': '2025',
            'country': 'Italy',
            'kalshi_series': ['KXSERIEAGAME', 'KXSERIEABTTS', 'KXSERIEATOTALS'],
            'kalshi_game_series': 'KXSERIEAGAME',
            'enabled': True,
            'priority': 2
          },
          'bundesliga': {
            'name': 'Bundesliga',
            'api_football_league_id': '78',
            'season': '2025',
            'country': 'Germany',
            'kalshi_series': ['KXBUNDESLIGAGAME', 'KXBUNDESLIGABTTS'],
            'kalshi_game_series': 'KXBUNDESLIGAGAME',
            'enabled': True,
            'priority': 3
          },
          'la_liga': {
            'name': 'La Liga',
            'api_football_league_id': '140',
            'season': '2025',
            'country': 'Spain',
            'kalshi_series': ['KXLALIGAGAME', 'KXLALIGABTTS'],
            'kalshi_game_series': 'KXLALIGAGAME',
            'enabled': True,
            'priority': 4
          },
          'liga_portugal': {
            'name': 'Liga Portugal',
            'api_football_league_id': '94',
            'season': '2025',
            'country': 'Portugal',
            'kalshi_series': ['KXLIGAPORTUGALGAME', 'KXPRIMEIRALIGAGAME'],
            'kalshi_game_series': 'KXLIGAPORTUGALGAME',
            'enabled': True,
            'priority': 5
          },
          'ligue_1': {
            'name': 'Ligue 1',
            'api_football_league_id': '61',
            'season': '2025',
            'country': 'France',
            'kalshi_series': ['KXLIGUE1GAME'],
            'kalshi_game_series': 'KXLIGUE1GAME',
            'enabled': False,
            'priority': 6
          }
        }

    # Extract all Kalshi series IDs for enabled leagues
    - type: globals
      labels:
        - kalshi_series_ids
      value: |
        [
          series
          for league_key, league_data in $.get('all_leagues', {}).items()
          if league_data.get('enabled', False)
          for series in league_data.get('kalshi_series', [])
        ]

    # Get config for a specific league
    - type: globals
      labels:
        - league_config
      value: |
        $.get('all_leagues', {}).get($.get('league_key'), {})

    # Build reverse lookup: API-Football league ID -> league config
    - type: globals
      labels:
        - league_by_api_id
      value: |
        {
          league_data.get('api_football_league_id'): {**league_data, 'key': league_key}
          for league_key, league_data in $.get('all_leagues', {}).items()
          if league_data.get('enabled', False)
        }

    # Build reverse lookup: Kalshi series -> league config
    - type: globals
      labels:
        - league_by_kalshi_series
      value: |
        {
          series: {**league_data, 'key': league_key}
          for league_key, league_data in $.get('all_leagues', {}).items()
          if league_data.get('enabled', False)
          for series in league_data.get('kalshi_series', [])
        }

    # Get enabled leagues as list
    - type: globals
      labels:
        - enabled_leagues
      value: |
        sorted(
          [
            {**league_data, 'key': league_key}
            for league_key, league_data in $.get('all_leagues', {}).items()
            if league_data.get('enabled', False)
          ],
          key=lambda x: x.get('priority', 999)
        )

