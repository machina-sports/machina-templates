mappings:

  # iptc-api-basketball-event-mapping
  - type: mapping
    name: iptc-api-basketball-event-mapping
    title: "IPTC | API Basketball Event Mapping"
    description: "Mapping data from api-basketball to sportschema event"
    outputs:
      sport_schema_events: |
        [
          {
            "@context": {
              "sport": "https://www.sportschema.org/ontologies/sport#",
              "schema": "https://schema.org/"
            },
            "@id": f"urn:apibasketball:sport_event:{f.get('game', {}).get('id')}",
            "@type": ["sport:Event", "schema:SportsEvent"],
            "name": f"{f.get('teams', {}).get('home', {}).get('name')} vs {f.get('teams', {}).get('away', {}).get('name')} - {f.get('league', {}).get('name')}",
            "schema:startDate": f.get('game', {}).get('date'),
            "sport:status": f.get('game', {}).get('status', {}).get('long'),
            "sport:competition": {
              "@id": f"urn:apibasketball:league:{f.get('league', {}).get('id')}",
              "@type": "sport:Competition",
              "name": f.get('league', {}).get('name'),
              "sport:season": {
                "@id": f"urn:apibasketball:season:{f.get('league', {}).get('id')}:{f.get('league', {}).get('season')}",
                "@type": "sport:Season",
                "name": f"{f.get('country', {}).get('name')} {f.get('league', {}).get('name')} {f.get('league', {}).get('season')}",
                "sport:year": f"{f.get('league', {}).get('season')}"
              }
            },
            "sport:venue": {
              "@type": "sport:Venue",
              "@id": f"urn:apibasketball:venue:{f.get('game', {}).get('venue', {}).get('id')}",
              "name": f.get('game', {}).get('venue', {}).get('name'),
              "schema:addressLocality": f.get('game', {}).get('venue', {}).get('city')
            },
            "sport:competitors": [
              {
                "@type": "sport:Team",
                "@id": f"urn:apibasketball:team:{f.get('teams', {}).get('home', {}).get('id')}",
                "name": f.get('teams', {}).get('home', {}).get('name'),
                "sport:qualifier": "home",
                "schema:logo": f.get('teams', {}).get('home', {}).get('logo')
              },
              {
                "@type": "sport:Team",
                "@id": f"urn:apibasketball:team:{f.get('teams', {}).get('away', {}).get('id')}",
                "name": f.get('teams', {}).get('away', {}).get('name'),
                "sport:qualifier": "away",
                "schema:logo": f.get('teams', {}).get('away', {}).get('logo')
              }
            ],
            "sport:score": {
              "sport:homeScore": f.get('scores', {}).get('home', {}).get('total'),
              "sport:awayScore": f.get('scores', {}).get('away', {}).get('total'),
              "sport:quarter1": {
                "sport:homeScore": f.get('scores', {}).get('home', {}).get('quarter_1'),
                "sport:awayScore": f.get('scores', {}).get('away', {}).get('quarter_1')
              },
              "sport:quarter2": {
                "sport:homeScore": f.get('scores', {}).get('home', {}).get('quarter_2'),
                "sport:awayScore": f.get('scores', {}).get('away', {}).get('quarter_2')
              },
              "sport:quarter3": {
                "sport:homeScore": f.get('scores', {}).get('home', {}).get('quarter_3'),
                "sport:awayScore": f.get('scores', {}).get('away', {}).get('quarter_3')
              },
              "sport:quarter4": {
                "sport:homeScore": f.get('scores', {}).get('home', {}).get('quarter_4'),
                "sport:awayScore": f.get('scores', {}).get('away', {}).get('quarter_4')
              }
            }
          }
          for f in $.get('games', [])
        ]

  # iptc-api-basketball-id-conversion-mapping
  - type: mapping
    title: "IPTC | API Basketball ID Conversion Mapping"
    name: "iptc-api-basketball-id-conversion-mapping"
    description: "Convert IPTC URN IDs to original API Basketball IDs and preserve URN"
    outputs:
      original_ids: |
        [
          f.get('@id', '').replace('urn:apibasketball:sport_event:', '') if f.get('@id', '').startswith('urn:apibasketball:sport_event:') else (
            f.get('@id', '').replace('urn:apibasketball:game:', '') if f.get('@id', '').startswith('urn:apibasketball:game:') else f.get('@id', '')
          )
          for f in $.get('iptc_schema_events', [])
        ]
      iptc_schema_ids: |
        [
          f.get('@id', '') if f.get('@id', '').startswith('urn:apibasketball:') else f'urn:apibasketball:sport_event:{f.get("@id", "")}'
          for f in $.get('iptc_schema_events', [])
        ]

  # iptc-api-basketball-events-mapping
  - type: mapping
    title: "IPTC | API Basketball Events Mapping"
    name: "iptc-api-basketball-events-mapping"
    description: "Convert API Basketball match events to IPTC Sports Schema format"
    outputs:
      iptc_events: |
        [
          {
            "@context": {
              "sport": "https://sportschema.org/ontologies/main/"
            },
            "@id": f"urn:apibasketball:action:{event.get('time', '')}:{event.get('action_type', '').replace(' ', '-')}:{event.get('team_id', '')}",
            "@type": "sport:Action",
            "sport:label": f"{event.get('action_type', '')} - {event.get('action_detail', '')}",
            "sport:actionType": f"http://cv.iptc.org/newscodes/spsocaction/{event.get('action_type', '').lower().replace(' ', '-')}:{event.get('action_detail', '').lower().replace(' ', '-')}",
            "sport:minutesElapsed": str(event.get('time', '')),
            "sport:actionDateTime": str(event.get('time', '')),
            "sport:comment": event.get('comment', ''),
            "sport:participation": [
              {
                "@id": f"urn:apibasketball:team-participation:{event.get('team_id', '')}",
                "@type": "sport:TeamParticipation",
                "sport:participationBy": {
                  "@id": f"urn:apibasketball:team:{event.get('team_id', '')}",
                  "@type": "sport:Team",
                  "sport:label": event.get('team_name', '')
                }
              }
            ] + ([
              {
                "@id": f"urn:apibasketball:player-participation:{event.get('player_id', '')}",
                "@type": "sport:IndividualParticipation",
                "sport:participationBy": {
                  "@id": f"urn:apibasketball:player:{event.get('player_id', '')}",
                  "@type": "sport:Athlete",
                  "sport:label": event.get('player_name', '')
                }
              }
            ] if event.get('player_id') else [])
          }
          for event in $.get('game_events', [])
        ]
