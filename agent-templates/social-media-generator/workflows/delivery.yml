workflow:
  name: social-media-content-delivery
  title: Social Media Content Delivery
  description: Prepare and format content for frontend consumption
  context-variables:
    debugger:
      enabled: true
  inputs:
    content_document_id: "$.get('content_document_id')"
    content_type: "$.get('content_type')"
  outputs:
    workflow-status: "$.get('workflow_executed_status', 'executed')"
    content_url: "$.get('content_url')"
    delivery_ready: "$.get('delivery_ready', True)"
  tasks:
    # 1. Load generated content
    - type: document
      name: load-content
      config:
        action: search
        search-limit: 1
      filters:
        _id: $.get('content_document_id')
      inputs:
        name: "'social-media-content'"
      outputs:
        content_data: "$.get('documents')[0].get('value') if len($.get('documents', [])) > 0 else {}"

    # 2. Format for delivery
    - type: python
      name: format-delivery
      inputs:
        content_data: "$.get('content_data')"
        content_type: "$.get('content_type')"
      outputs:
        formatted_content: "$.get('content_data')"
        content_url: "'/api/content/' + str($.get('content_document_id'))"
        delivery_ready: True
        workflow_executed_status: "'executed'"

